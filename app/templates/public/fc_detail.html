{% extends 'base.html' %}

{% block title %}{{ fc.name }}{% endblock %}

{% block content %}
<section class="section page-section fc-detail-section">
    <div class="container">
        <!-- Back Link -->
        <a href="{{ url_for('public.fc_list') }}" class="back-link">
            ‚Üê Back to FCs
        </a>

        <!-- FC Header -->
        <div class="fc-detail-header">
            <div class="fc-detail-avatar">
                {% if fc.avatar_url %}
                <img src="{{ fc.avatar_url }}" alt="{{ fc.name }}">
                {% else %}
                <span class="fc-avatar-placeholder large">{{ fc.name[0].upper() }}</span>
                {% endif %}
            </div>

            <div class="fc-detail-info">
                <h1 class="fc-detail-name">{{ fc.name }}</h1>
                {% if fc.corporation or fc.alliance %}
                <p class="fc-detail-affiliation">
                    {% if fc.corporation %}{{ fc.corporation }}{% endif %}
                    {% if fc.corporation and fc.alliance %} ‚Ä¢ {% endif %}
                    {% if fc.alliance %}{{ fc.alliance }}{% endif %}
                </p>
                {% endif %}
                {% if fc.bio %}
                <p class="fc-detail-bio">{{ fc.bio }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Current Tags -->
        <div class="fc-detail-tags">
            <h2 class="section-subtitle">
                <span class="title-icon">üèÜ</span>
                Earned Badges
            </h2>

            {% if tag_counts %}
            <div class="tags-grid">
                {% for tag_id, count in tag_counts.items()|sort(attribute='1', reverse=true) %}
                {% set tag = all_tags.get(tag_id) %}
                {% if tag %}
                <div
                    class="tag-card {% if loop.index == 1 %}tag-gold{% elif loop.index == 2 %}tag-silver{% elif loop.index == 3 %}tag-bronze{% endif %}">
                    <span class="tag-emoji">{{ tag.emoji }}</span>
                    <span class="tag-name">{{ tag.name }}</span>
                    <span class="tag-count">{{ count }} vote{{ 's' if count != 1 else '' }}</span>
                    <span class="tag-desc">{{ tag.description }}</span>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-tags">
                <p>No badges yet. Be the first to vote! üéØ</p>
            </div>
            {% endif %}
        </div>

        <!-- Voting Section -->
        <div class="voting-section" id="votingSection">
            <h2 class="section-subtitle">
                <span class="title-icon">üó≥Ô∏è</span>
                Give a Badge
            </h2>

            <p class="voting-intro">
                Choose a badge that best represents this FC!
            </p>

            <div class="voting-tags" id="votingTags">
                {% include 'public/_voting_tags.html' %}
            </div>

            <button class="btn btn-secondary btn-refresh" id="refreshTags" onclick="refreshVotingTags()">
                üé≤ Show other badges
            </button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    function refreshVotingTags() {
        const container = document.getElementById('votingTags');
        container.classList.add('loading');

        fetch('{{ url_for("public.refresh_tags", fc_id=fc.id) }}')
            .then(response => response.text())
            .then(html => {
                container.innerHTML = html;
                container.classList.remove('loading');
            })
            .catch(error => {
                console.error('Error:', error);
                container.classList.remove('loading');
            });
    }
</script>
{% endblock %}